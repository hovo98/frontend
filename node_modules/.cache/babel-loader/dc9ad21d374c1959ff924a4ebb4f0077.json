{"ast":null,"code":"import _objectSpread from\"/root/dex/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/root/dex/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/root/dex/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/root/dex/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/root/dex/frontend/node_modules/@babel/runtime/regenerator/index.js\";import useSharedState from'../hook/useSharedState';import React,{useState,useEffect,useCallback,useMemo}from\"react\";import io from'socket.io-client';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function Tokens(){var _useSharedState=useSharedState(),selectedToken=_useSharedState.selectedToken,setSelectedToken=_useSharedState.setSelectedToken,bnbPrice=_useSharedState.bnbPrice,setBnbPrice=_useSharedState.setBnbPrice,ask=_useSharedState.ask,setAsk=_useSharedState.setAsk,long=_useSharedState.long,setLong=_useSharedState.setLong,setBid=_useSharedState.setBid,tokensList=_useSharedState.tokensList,setTokensList=_useSharedState.setTokensList;//useState(undefined);\nvar favpos=\"favbsc\";var _useState=useState(localStorage.getItem(favpos)?JSON.parse(localStorage.getItem(favpos)):{}),_useState2=_slicedToArray(_useState,2),fav=_useState2[0],setFav=_useState2[1];var _useState3=useState('CHANGE'),_useState4=_slicedToArray(_useState3,2),sortMode=_useState4[0],setSortMode=_useState4[1];var options=['CHANGE','VOLUME'];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),order=_useState6[0],setOrder=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),sortedData=_useState8[0],setSortedData=_useState8[1];useEffect(function(){var init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var prefix,url,response,pairs,i,socket,socketbnb;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:prefix=window.location.protocol+\"//\"+window.location.hostname;url=prefix+\"/api/getdata?op=pairs24h\";_context.next=4;return fetch(url);case 4:response=_context.sent;_context.next=7;return response.json();case 7:pairs=_context.sent;setTokensList(pairs);for(i=0;i<pairs.length;i++){if(pairs[i].symbol==\"USDT\"){setBnbPrice(Number(pairs[i].priceUSD));if(!selectedToken){setSelectedToken(pairs[i]);}}}socket=io(prefix);socket.emit(\"join\",\"pairs24h\");// listen for new messages\nsocket.on(\"data\",function(data){setTokensList(data);if(selectedToken){var _loop=function _loop(_i){if(data[_i].symbol==selectedToken.symbol){setAsk(function(ask){setLong(ask<=Number(data[_i].priceBNB));return Number(data[_i].priceBNB);});setBid(Number(data[_i].priceBNB));}};for(var _i=0;_i<data.length;_i++){_loop(_i);}}});socketbnb=io(prefix);socketbnb.emit(\"join\",\"USDT\");// listen for new messages\nsocketbnb.on(\"orderbook\",function(data){setBnbPrice(Number(data.asks[0][0]));});case 16:case\"end\":return _context.stop();}}},_callee);}));return function init(){return _ref.apply(this,arguments);};}();init();},[]);useEffect(function(){var setSortData=function setSortData(){if((tokensList===null||tokensList===void 0?void 0:tokensList.length)>0){var newData=tokensList;newData.sort(function(a,b){if(fav[a.address])return-1;if(fav[b.address])return 1;if(fav[a.address]&&fav[b.address])return 0;if(sortMode=='CHANGE')return Math.sign((b.priceBNBChange-a.priceBNBChange)*(1-2*order));return Math.sign((b.volumeUSDChange-a.volumeUSDChange)*(1-2*order));});setSortedData(_toConsumableArray(newData));}};setSortData();},[tokensList,sortMode,fav]);var setToken=function setToken(token){setSelectedToken(token);setLong(true);setAsk(Number(token.priceBNB));};var changeFav=function changeFav(token){if(fav[token.address]){removeFav(token);}else{addFav(token);}};var addFav=function addFav(token){var newFav=fav;newFav[token.address]=true;setFav(_objectSpread({},newFav));localStorage.setItem(favpos,JSON.stringify(newFav));};var removeFav=function removeFav(token){var newFav=fav;delete newFav[token.address];setFav(_objectSpread({},newFav));localStorage.setItem(favpos,JSON.stringify(newFav));};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"row m-0\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-12 p-0 m-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-check form-check-inline m-0 pe-2\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-check-input\",value:\"CHANGE\",checked:sortMode===\"CHANGE\",onChange:function onChange(e){setSortMode(e.currentTarget.value);},type:\"radio\",name:\"inlineRadioOptions\",id:\"inlineRadio1\"}),/*#__PURE__*/_jsx(\"label\",{className:\"form-check-label\",htmlFor:\"inlineRadio1\",children:\"Change\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-check form-check-inline m-0\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-check-input\",value:\"VOLUME\",checked:sortMode===\"VOLUME\",onChange:function onChange(e){setSortMode(e.currentTarget.value);},type:\"radio\",name:\"inlineRadioOptions\",id:\"inlineRadio2\"}),/*#__PURE__*/_jsx(\"label\",{className:\"form-check-label\",htmlFor:\"inlineRadio2\",children:\"Volume\"})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"tab-pane fade show active\",id:\"pills-bnb\",role:\"tabpanel\",\"aria-labelledby\":\"pills-bnb-tab\",children:/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",style:{\"height\":\"200px\",\"overflowY\":\"scroll\"},children:/*#__PURE__*/_jsxs(\"table\",{className:\"table text-white table-sm table-borderless\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"text-muted\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Pair\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Price\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Change\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{children:[sortedData.length==0&&/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"3\",children:\"Loading...\"})}),sortedData.map(function(token,idx){return/*#__PURE__*/_jsxs(\"tr\",{role:\"button\",onClick:function onClick(e){setToken(token);},children:[/*#__PURE__*/_jsxs(\"td\",{className:\"text-nowrap\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi  me-1 text-warning \"+(fav[token.address]?\"bi-star-fill\":\"bi-star\"),onClick:function onClick(e){e.stopPropagation();changeFav(token);}}),token.info.base,\"/\",token.info.quote]}),/*#__PURE__*/_jsx(\"td\",{children:token.priceBNB}),sortMode=='CHANGE'&&/*#__PURE__*/_jsxs(\"td\",{className:\"text-end pe-2 \"+(token.priceBNBChange>0?\" text-success\":\"text-danger\"),children:[token.priceBNBChange>0?\"+\":\"\",token.priceBNBChange.toFixed(2),\"%\"]}),sortMode=='VOLUME'&&/*#__PURE__*/_jsxs(\"td\",{className:\"text-end pe-2 \"+(token.volumeUSDChange>0?\" text-success\":\"text-danger\"),children:[token.volumeUSDChange>0?\"+\":\"\",token.volumeUSDChange.toFixed(2),\"%\"]})]},idx);})]})]})})})]});}export default Tokens;","map":{"version":3,"sources":["/root/dex/frontend/src/component/Tokens.js"],"names":["useSharedState","React","useState","useEffect","useCallback","useMemo","io","Tokens","selectedToken","setSelectedToken","bnbPrice","setBnbPrice","ask","setAsk","long","setLong","setBid","tokensList","setTokensList","favpos","localStorage","getItem","JSON","parse","fav","setFav","sortMode","setSortMode","options","order","setOrder","sortedData","setSortedData","init","prefix","window","location","protocol","hostname","url","fetch","response","json","pairs","i","length","symbol","Number","priceUSD","socket","emit","on","data","priceBNB","socketbnb","asks","setSortData","newData","sort","a","b","address","Math","sign","priceBNBChange","volumeUSDChange","setToken","token","changeFav","removeFav","addFav","newFav","setItem","stringify","e","currentTarget","value","map","idx","stopPropagation","info","base","quote","toFixed"],"mappings":"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","sourcesContent":["import useSharedState from '../hook/useSharedState'\r\nimport React ,{useState,useEffect,useCallback,useMemo} from \"react\";\r\nimport io from 'socket.io-client';\r\n\r\nfunction Tokens() {\r\n\r\n  const {selectedToken,setSelectedToken,bnbPrice,setBnbPrice,ask,setAsk,long,setLong,setBid,tokensList,setTokensList}=useSharedState();//useState(undefined);\r\n  const favpos = \"favbsc\";\r\n  const [fav,setFav]=useState(localStorage.getItem(favpos)?JSON.parse(localStorage.getItem(favpos)):{})\r\n  const [sortMode, setSortMode] = useState('CHANGE');\r\n  const options = ['CHANGE', 'VOLUME'];\r\n  const [order,setOrder]=useState(0)\r\n\r\n  const [sortedData, setSortedData] = useState([]);\r\n\r\n  useEffect(() => {\r\n      const init=async()=>{\r\n        const prefix = window.location.protocol+\"//\"+window.location.hostname;\r\n        const url = prefix+\"/api/getdata?op=pairs24h\";\r\n        const response = await fetch(url);\r\n        const pairs = await response.json();\r\n        setTokensList(pairs);\r\n        for(let i=0;i<pairs.length;i++){\r\n          if(pairs[i].symbol==\"USDT\"){\r\n            setBnbPrice(Number(pairs[i].priceUSD));\r\n            if(!selectedToken){\r\n              setSelectedToken(pairs[i]);\r\n            }\r\n          }\r\n        }\r\n\r\n        const socket = io(prefix);\r\n        socket.emit(\"join\",\"pairs24h\");\r\n          // listen for new messages\r\n        socket.on(\"data\", function(data) {\r\n            setTokensList(data);\r\n            if(selectedToken){\r\n              for(let i=0;i<data.length;i++){\r\n                if(data[i].symbol==selectedToken.symbol){\r\n                  setAsk((ask)=>{\r\n                    setLong(ask<=Number(data[i].priceBNB));\r\n                    return Number(data[i].priceBNB)\r\n                  });\r\n                  setBid(Number(data[i].priceBNB));\r\n\r\n                }\r\n              }\r\n            }\r\n          });\r\n\r\n        const socketbnb = io(prefix);\r\n        socketbnb.emit(\"join\",\"USDT\");\r\n          // listen for new messages\r\n        socketbnb.on(\"orderbook\", function(data) {\r\n            setBnbPrice(Number(data.asks[0][0]));\r\n          });\r\n      }\r\n      init();\r\n  }, []) \r\n\r\n  useEffect(() => {\r\n      const setSortData =()=>{\r\n          if(tokensList?.length>0){\r\n              let newData = tokensList;\r\n              newData.sort((a, b) => {\r\n                  if(fav[a.address]) return -1;\r\n                  if(fav[b.address]) return 1;\r\n                  if(fav[a.address] && fav[b.address]) return 0;\r\n                  \r\n                  if(sortMode =='CHANGE') return Math.sign((b.priceBNBChange-a.priceBNBChange)*(1-2*order))\r\n                  return Math.sign((b.volumeUSDChange-a.volumeUSDChange)*(1-2*order))\r\n              });\r\n              setSortedData([...newData]);\r\n          }\r\n      }\r\n      setSortData();\r\n    }, [tokensList,sortMode,fav])\r\n\r\n\r\n    const setToken = (token)=>{\r\n        setSelectedToken(token);\r\n        setLong(true);\r\n        setAsk(Number(token.priceBNB));\r\n    }\r\n\r\n    const changeFav = (token)=>{\r\n        if(fav[token.address]){\r\n            removeFav(token);\r\n        }else{\r\n            addFav(token);\r\n        }\r\n    }\r\n    \r\n    const addFav=(token)=>{\r\n        let newFav=fav; \r\n        newFav[token.address]=true;\r\n        setFav({...newFav})\r\n        localStorage.setItem(favpos,JSON.stringify(newFav));\r\n    }\r\n    const removeFav=(token)=>{\r\n        let newFav=fav;\r\n        delete newFav[token.address];\r\n        setFav({...newFav})\r\n        localStorage.setItem(favpos,JSON.stringify(newFav));\r\n    }\r\n  return (\r\n          <>\r\n              <div className=\"row m-0\">\r\n                <div className=\"col-12 p-0 m-0\">\r\n                  <div className=\"form-check form-check-inline m-0 pe-2\">\r\n                    <input className=\"form-check-input\" value=\"CHANGE\" checked={sortMode === \"CHANGE\"} onChange={(e)=>{setSortMode(e.currentTarget.value)}} type=\"radio\" name=\"inlineRadioOptions\" id=\"inlineRadio1\" />\r\n                    <label className=\"form-check-label\" htmlFor={\"inlineRadio1\"}>Change</label>\r\n                  </div>\r\n                  <div className=\"form-check form-check-inline m-0\">\r\n                    <input className=\"form-check-input\" value=\"VOLUME\" checked={sortMode === \"VOLUME\"} onChange={(e)=>{setSortMode(e.currentTarget.value)}} type=\"radio\" name=\"inlineRadioOptions\" id=\"inlineRadio2\" />\r\n                    <label className=\"form-check-label\" htmlFor={\"inlineRadio2\"}>Volume</label>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"tab-pane fade show active\" id=\"pills-bnb\" role=\"tabpanel\" aria-labelledby=\"pills-bnb-tab\">\r\n                <div className=\"table-responsive\" style={{\"height\":\"200px\",\"overflowY\":\"scroll\"}}>\r\n                  <table className=\"table text-white table-sm table-borderless\">\r\n                    <thead className=\"text-muted\" >\r\n                      <tr>\r\n                        <th scope=\"col\">Pair</th>\r\n                        <th scope=\"col\">Price</th>\r\n                        <th scope=\"col\">Change</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                    {sortedData.length==0 &&\r\n                      <tr>\r\n                        <td colSpan=\"3\">Loading...</td>\r\n                      </tr>\r\n                    }\r\n                    {sortedData.map((token,idx)=>(\r\n                        <tr role=\"button\" key={idx} onClick={(e)=>{setToken(token)}} >\r\n                          <td className=\"text-nowrap\">\r\n                            <i className={\"bi  me-1 text-warning \"+(fav[token.address]?\"bi-star-fill\":\"bi-star\")} onClick={(e)=>{e.stopPropagation();changeFav(token)}}/> \r\n                            {token.info.base}/{token.info.quote}\r\n                           </td>\r\n                          <td>{token.priceBNB}</td>\r\n                          {sortMode =='CHANGE' && \r\n                            <td className={\"text-end pe-2 \"+(token.priceBNBChange>0?\" text-success\":\"text-danger\")}>{token.priceBNBChange>0?\"+\":\"\"}{token.priceBNBChange.toFixed(2)}%</td>\r\n                          }\r\n                          {sortMode =='VOLUME' && \r\n                            <td className={\"text-end pe-2 \"+(token.volumeUSDChange>0?\" text-success\":\"text-danger\")}>{token.volumeUSDChange>0?\"+\":\"\"}{token.volumeUSDChange.toFixed(2)}%</td>\r\n                          }\r\n                        </tr>\r\n                    ))}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n          </>\r\n  );\r\n}\r\n\r\nexport default Tokens;\r\n"]},"metadata":{},"sourceType":"module"}