{"ast":null,"code":"import _asyncToGenerator from\"/root/dex/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/root/dex/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/root/dex/frontend/node_modules/@babel/runtime/regenerator/index.js\";import useSharedState from'../hook/useSharedState';import React,{useState,useEffect,useCallback,useMemo}from\"react\";import io from'socket.io-client';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var orderbookcount=9;function Orderbook(){var _useSharedState=useSharedState(),selectedToken=_useSharedState.selectedToken,setSelectedToken=_useSharedState.setSelectedToken,bnbPrice=_useSharedState.bnbPrice,long=_useSharedState.long,setLong=_useSharedState.setLong,ask=_useSharedState.ask,setAsk=_useSharedState.setAsk,setBid=_useSharedState.setBid;//useState(undefined);\nvar _useState=useState({}),_useState2=_slicedToArray(_useState,2),orderbook=_useState2[0],setOrderbook=_useState2[1];//useState(undefined);\nvar fixedLength=function fixedLength(y){var num=y;var prec=6;while(num>10){num/=10;prec--;}return y.toFixed(prec);};useEffect(function(){var socket=undefined;var init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var prefix,url,response,rdata;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setOrderbook({});prefix=window.location.protocol+\"//\"+window.location.hostname;url=prefix+\"/api/getdata?op=orderbook&symbol=\"+selectedToken.symbol;_context.next=5;return fetch(url);case 5:response=_context.sent;_context.next=8;return response.json();case 8:rdata=_context.sent;setOrderbook(rdata);setAsk(Number(rdata.asks[0][0]));setBid(Number(rdata.bids[0][0]));if(!socket){socket=io(prefix);}else{socket.leaveAll();}socket.emit(\"join\",selectedToken.info.symbol);socket.on(\"orderbook\",function(data){if(orderbook.bids){setLong(data.bids[0][0]>Number(orderbook.bids[0][0]));}setAsk(Number(data.asks[0][0]));setBid(Number(data.bids[0][0]));setOrderbook(data);});case 15:case\"end\":return _context.stop();}}},_callee);}));return function init(){return _ref.apply(this,arguments);};}();if(selectedToken)init();return function(){if(socket){socket.disconnect();}};},[selectedToken]);return/*#__PURE__*/_jsxs(\"div\",{className:\"order-3 order-lg-3 col-12 col-lg-2 p-1 bg-dark text-white\",children:[/*#__PURE__*/_jsxs(\"ul\",{className:\"nav nav-pills mb-1\",id:\"pills-tab\",role:\"tablist\",children:[/*#__PURE__*/_jsx(\"li\",{className:\"nav-item\",role:\"presentation\",children:/*#__PURE__*/_jsx(\"button\",{className:\"nav-link bg-transparent\",id:\"pills-graph-tab\",\"data-bs-toggle\":\"pill\",\"data-bs-target\":\"#pills-graph\",type:\"button\",role:\"tab\",\"aria-controls\":\"pills-graph\",\"aria-selected\":\"false\",children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-graph-up text-white\"})})}),/*#__PURE__*/_jsx(\"li\",{className:\"nav-item\",role:\"presentation\",children:/*#__PURE__*/_jsx(\"button\",{className:\"nav-link bg-transparent\",id:\"pills-graph-up-tab\",\"data-bs-toggle\":\"pill\",\"data-bs-target\":\"#pills-graph-up\",type:\"button\",role:\"tab\",\"aria-controls\":\"pills-graph-up\",\"aria-selected\":\"false\",children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-graph-up-arrow text-success\"})})}),/*#__PURE__*/_jsx(\"li\",{className:\"nav-item\",role:\"presentation\",children:/*#__PURE__*/_jsx(\"button\",{className:\"nav-link bg-transparent\",id:\"pills-graph-down-tab\",\"data-bs-toggle\":\"pill\",\"data-bs-target\":\"#pills-graph-down\",type:\"button\",role:\"tab\",\"aria-controls\":\"pills-graph-down\",\"aria-selected\":\"false\",children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-graph-down-arrow text-danger\"})})})]}),orderbook.bids&&/*#__PURE__*/_jsxs(\"div\",{className:\"tab-content\",id:\"pills-graph-tabContent\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tab-pane fade show active\",id:\"pills-graph\",role:\"tabpanel\",\"aria-labelledby\":\"pills-graph-tab\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"table text-white table-sm table-borderless\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"text-muted\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Price\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Total\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:function(rows,i,len){if(orderbook.asks){while(i<len){rows.push(/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"text-danger\",children:fixedLength(Number(orderbook.asks[len-i-1][0]))}),/*#__PURE__*/_jsx(\"td\",{children:fixedLength(Number(orderbook.asks[len-i-1][1]))}),/*#__PURE__*/_jsx(\"td\",{children:fixedLength(Number(orderbook.asks[len-i-1][1])*Number(orderbook.asks[len-i-1][0]))})]},i));i++;}}return rows;}([],0,orderbookcount)})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsx(\"table\",{className:\"table text-white table-sm table-borderless\",children:/*#__PURE__*/_jsx(\"tbody\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"td\",{className:long?\"text-success\":\"text-danger\",children:[orderbook.asks?fixedLength(Number(orderbook.asks[0][0])):\"\",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-arrow-\"+(long?\"up\":\"down\")})]}),/*#__PURE__*/_jsxs(\"td\",{className:long?\"text-success\":\"text-danger\",children:[orderbook.bids?fixedLength(Number(orderbook.bids[0][0])):\"\",/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-arrow-\"+(long?\"up\":\"down\")})]})]})})})}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"table text-white table-sm table-borderless\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"text-muted\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Price\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Total\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:function(rows,i,len){if(orderbook.bids){while(i<len){rows.push(/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"text-success\",children:fixedLength(Number(orderbook.bids[i][0]))}),/*#__PURE__*/_jsx(\"td\",{children:fixedLength(Number(orderbook.bids[i][1]))}),/*#__PURE__*/_jsx(\"td\",{children:fixedLength(Number(orderbook.bids[i][1])*Number(orderbook.bids[i][0]))})]},i));i++;}}return rows;}([],0,orderbookcount)})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"tab-pane fade\",id:\"pills-graph-down\",role:\"tabpanel\",\"aria-labelledby\":\"pills-graph-down-tab\",children:/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"table text-white table-sm table-borderless\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"text-muted\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Price\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Total\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:function(rows){if(orderbook.asks){var len=orderbook.asks.length;var i=0;while(i<len){rows.push(/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"text-danger\",children:fixedLength(Number(orderbook.asks[len-i-1][0]))}),/*#__PURE__*/_jsx(\"td\",{children:fixedLength(Number(orderbook.asks[len-i-1][1]))}),/*#__PURE__*/_jsx(\"td\",{children:fixedLength(Number(orderbook.asks[len-i-1][1])*Number(orderbook.asks[len-i-1][0]))})]},i));i++;}}return rows;}([])})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"tab-pane fade\",id:\"pills-graph-up\",role:\"tabpanel\",\"aria-labelledby\":\"pills-graph-up-tab\",children:/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"table text-white table-sm table-borderless\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"text-muted\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Price\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Total\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:function(rows,i,len){if(orderbook.bids){var _len=orderbook.bids.length;var _i=0;while(_i<_len){rows.push(/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"text-success\",children:fixedLength(Number(orderbook.bids[_i][0]))}),/*#__PURE__*/_jsx(\"td\",{children:fixedLength(Number(orderbook.bids[_i][1]))}),/*#__PURE__*/_jsx(\"td\",{children:fixedLength(Number(orderbook.bids[_i][1])*Number(orderbook.bids[_i][0]))})]},_i));_i++;}}return rows;}([],0,6)})]})})})]})]});}export default Orderbook;","map":{"version":3,"sources":["/root/dex/frontend/src/component/Orderbook.js"],"names":["useSharedState","React","useState","useEffect","useCallback","useMemo","io","orderbookcount","Orderbook","selectedToken","setSelectedToken","bnbPrice","long","setLong","ask","setAsk","setBid","orderbook","setOrderbook","fixedLength","y","num","prec","toFixed","socket","undefined","init","prefix","window","location","protocol","hostname","url","symbol","fetch","response","json","rdata","Number","asks","bids","leaveAll","emit","info","on","data","disconnect","rows","i","len","push","length"],"mappings":"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","sourcesContent":["import useSharedState from '../hook/useSharedState'\r\nimport React ,{useState,useEffect,useCallback,useMemo} from \"react\";\r\nimport io from 'socket.io-client';\r\n\r\nconst orderbookcount =9;\r\n\r\nfunction Orderbook() {\r\n  const {selectedToken,setSelectedToken,bnbPrice,long,setLong,ask,setAsk,setBid}=useSharedState();//useState(undefined);\r\n  const [orderbook,setOrderbook]=useState({});//useState(undefined);\r\n  const fixedLength=(y)=> {\r\n    let num = y;\r\n    let prec = 6;\r\n    while(num > 10) {\r\n        num /= 10;\r\n        prec--;\r\n    }\r\n    return y.toFixed(prec);\r\n  }\r\n  useEffect(() => {\r\n      let socket=undefined;\r\n      const init=async()=>{\r\n        setOrderbook({});\r\n        const prefix = window.location.protocol+\"//\"+window.location.hostname;\r\n        const url = prefix+\"/api/getdata?op=orderbook&symbol=\"+selectedToken.symbol;\r\n        const response = await fetch(url);\r\n        const rdata = await response.json();\r\n        setOrderbook(rdata);\r\n        setAsk(Number(rdata.asks[0][0]));\r\n        setBid(Number(rdata.bids[0][0]));\r\n        \r\n        if(!socket){\r\n          socket = io(prefix);\r\n        }else{\r\n          socket.leaveAll();\r\n        }\r\n        socket.emit(\"join\",selectedToken.info.symbol);\r\n        socket.on(\"orderbook\", function(data) {\r\n            if(orderbook.bids){\r\n                setLong(data.bids[0][0]>Number(orderbook.bids[0][0]));\r\n            }\r\n            setAsk(Number(data.asks[0][0]));\r\n            setBid(Number(data.bids[0][0]));\r\n\r\n            setOrderbook(data);\r\n        });\r\n      }\r\n      if(selectedToken) init();\r\n      return () => {\r\n        if (socket) {\r\n          socket.disconnect();\r\n        }\r\n      }\r\n  }, [selectedToken]) \r\n\r\n  return (\r\n  <div className=\"order-3 order-lg-3 col-12 col-lg-2 p-1 bg-dark text-white\">\r\n      <ul className=\"nav nav-pills mb-1\" id=\"pills-tab\" role=\"tablist\">\r\n        <li className=\"nav-item\" role=\"presentation\">\r\n          <button className=\"nav-link bg-transparent\" id=\"pills-graph-tab\" data-bs-toggle=\"pill\" data-bs-target=\"#pills-graph\" type=\"button\" role=\"tab\" aria-controls=\"pills-graph\" aria-selected=\"false\">\r\n            <i className=\"bi bi-graph-up text-white\" />\r\n          </button>\r\n        </li>\r\n        <li className=\"nav-item\" role=\"presentation\">\r\n          <button className=\"nav-link bg-transparent\" id=\"pills-graph-up-tab\" data-bs-toggle=\"pill\" data-bs-target=\"#pills-graph-up\" type=\"button\" role=\"tab\" aria-controls=\"pills-graph-up\" aria-selected=\"false\">\r\n            <i className=\"bi bi-graph-up-arrow text-success\" />\r\n          </button>\r\n        </li>\r\n        <li className=\"nav-item\" role=\"presentation\">\r\n          <button className=\"nav-link bg-transparent\" id=\"pills-graph-down-tab\" data-bs-toggle=\"pill\" data-bs-target=\"#pills-graph-down\" type=\"button\" role=\"tab\" aria-controls=\"pills-graph-down\" aria-selected=\"false\">\r\n            <i className=\"bi bi-graph-down-arrow text-danger\" />\r\n          </button>\r\n        </li>\r\n      </ul>\r\n      {orderbook.bids && \r\n\r\n      <div className=\"tab-content\" id=\"pills-graph-tabContent\">\r\n        <div className=\"tab-pane fade show active\" id=\"pills-graph\" role=\"tabpanel\" aria-labelledby=\"pills-graph-tab\">\r\n          <div className=\"table-responsive\">\r\n            <table className=\"table text-white table-sm table-borderless\">\r\n              <thead className=\"text-muted\">\r\n                <tr>\r\n                  <th scope=\"col\">Price</th>\r\n                  <th scope=\"col\">Amount</th>\r\n                  <th scope=\"col\">Total</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                { \r\n                  (function (rows, i, len) {\r\n                    if(orderbook.asks){\r\n                      while (i < len) {\r\n                        rows.push(\r\n                          <tr key={i}>\r\n                            <td className=\"text-danger\">{fixedLength(Number(orderbook.asks[len-i-1][0]))}</td>\r\n                            <td>{fixedLength(Number(orderbook.asks[len-i-1][1]))}</td>\r\n                            <td>{fixedLength(Number(orderbook.asks[len-i-1][1])*Number(orderbook.asks[len-i-1][0]))}</td>\r\n                          </tr>\r\n                        );\r\n                        i++;\r\n                      }\r\n                    }\r\n                    return rows;\r\n                  })([], 0, orderbookcount)\r\n                }\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          <div className=\"table-responsive\">\r\n            <table className=\"table text-white table-sm table-borderless\">\r\n              <tbody>\r\n                <tr>\r\n                  <td className={long?\"text-success\":\"text-danger\"}>\r\n                    {orderbook.asks ? fixedLength(Number(orderbook.asks[0][0])):\"\"}\r\n                    <i className={\"bi bi-arrow-\"+(long?\"up\":\"down\")} />\r\n                  </td>\r\n                  <td className={long?\"text-success\":\"text-danger\"}>\r\n                    {orderbook.bids ? fixedLength(Number(orderbook.bids[0][0])):\"\"}\r\n                    <i className={\"bi bi-arrow-\"+(long?\"up\":\"down\")} />\r\n                  </td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          <div className=\"table-responsive\">\r\n            <table className=\"table text-white table-sm table-borderless\">\r\n              <thead className=\"text-muted\">\r\n                <tr>\r\n                  <th scope=\"col\">Price</th>\r\n                  <th scope=\"col\">Amount</th>\r\n                  <th scope=\"col\">Total</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                { \r\n                  (function (rows, i, len) {\r\n                    if(orderbook.bids){\r\n                      while (i < len) {\r\n                        rows.push(\r\n                          <tr key={i}>\r\n                            <td className=\"text-success\">{fixedLength(Number(orderbook.bids[i][0]))}</td>\r\n                            <td>{fixedLength(Number(orderbook.bids[i][1]))}</td>\r\n                            <td>{fixedLength(Number(orderbook.bids[i][1])*Number(orderbook.bids[i][0]))}</td>\r\n                          </tr>\r\n                        );\r\n                        i++;\r\n                      }\r\n                    }\r\n                    return rows;\r\n                  })([], 0, orderbookcount)\r\n                }\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n        <div className=\"tab-pane fade\" id=\"pills-graph-down\" role=\"tabpanel\" aria-labelledby=\"pills-graph-down-tab\">\r\n          <div className=\"table-responsive\">\r\n            <table className=\"table text-white table-sm table-borderless\">\r\n              <thead className=\"text-muted\">\r\n                <tr>\r\n                  <th scope=\"col\">Price</th>\r\n                  <th scope=\"col\">Amount</th>\r\n                  <th scope=\"col\">Total</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                { \r\n                  (function (rows) {\r\n                    if(orderbook.asks){\r\n                      const len = orderbook.asks.length;\r\n                      let i=0;\r\n                      while (i < len) {\r\n                        rows.push(\r\n                          <tr key={i}>\r\n                            <td className=\"text-danger\">{fixedLength(Number(orderbook.asks[len-i-1][0]))}</td>\r\n                            <td>{fixedLength(Number(orderbook.asks[len-i-1][1]))}</td>\r\n                            <td>{fixedLength(Number(orderbook.asks[len-i-1][1])*Number(orderbook.asks[len-i-1][0]))}</td>\r\n                          </tr>\r\n                        );\r\n                        i++;\r\n                      }\r\n                    }\r\n                    return rows;\r\n                  })([])\r\n                }\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n        <div className=\"tab-pane fade\" id=\"pills-graph-up\" role=\"tabpanel\" aria-labelledby=\"pills-graph-up-tab\">\r\n          <div className=\"table-responsive\">\r\n            <table className=\"table text-white table-sm table-borderless\">\r\n              <thead className=\"text-muted\">\r\n                <tr>\r\n                  <th scope=\"col\">Price</th>\r\n                  <th scope=\"col\">Amount</th>\r\n                  <th scope=\"col\">Total</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                { \r\n                  (function (rows, i, len) {\r\n                    if(orderbook.bids){\r\n                      const len =  orderbook.bids.length;\r\n                      let i=0;\r\n\r\n                      while (i < len) {\r\n                        rows.push(\r\n                          <tr key={i}>\r\n                            <td className=\"text-success\">{fixedLength(Number(orderbook.bids[i][0]))}</td>\r\n                            <td>{fixedLength(Number(orderbook.bids[i][1]))}</td>\r\n                            <td>{fixedLength(Number(orderbook.bids[i][1])*Number(orderbook.bids[i][0]))}</td>\r\n                          </tr>\r\n                        );\r\n                        i++;\r\n                      }\r\n                    }\r\n                    return rows;\r\n                  })([], 0, 6)\r\n                }\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      }\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Orderbook;\r\n"]},"metadata":{},"sourceType":"module"}