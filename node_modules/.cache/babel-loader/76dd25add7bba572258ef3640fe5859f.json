{"ast":null,"code":"import _asyncToGenerator from\"/root/dex/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/root/dex/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/root/dex/frontend/node_modules/@babel/runtime/regenerator/index.js\";import useSharedState from'../hook/useSharedState';import React,{useState,useEffect,useCallback,useMemo,useRef}from\"react\";import{useWeb3React}from'@web3-react/core';import{fixedLength,adjustDate}from\"./common\";import{ERC20_ABI}from\"../abi/ERC20\";import{WETH,limitOrder}from\"./const\";import{getContract}from\"./contract\";import{LIMIT_ABI}from\"../abi/LIMIT\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Orderhistory(){var _useSharedState=useSharedState(),selectedToken=_useSharedState.selectedToken,setSelectedToken=_useSharedState.setSelectedToken,bnbPrice=_useSharedState.bnbPrice,tokensList=_useSharedState.tokensList;//useState(undefined);\nvar _useWeb3React=useWeb3React(),chainId=_useWeb3React.chainId,account=_useWeb3React.account,activate=_useWeb3React.activate,active=_useWeb3React.active,library=_useWeb3React.library;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),openOrders=_useState2[0],setOpenOrders=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),tradeHistories=_useState4[0],setTradeHistories=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),balances=_useState6[0],setBalances=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),totalBnbBalance=_useState8[0],setTotalBnbBalance=_useState8[1];var _useState9=useState(3600*24*30),_useState10=_slicedToArray(_useState9,2),timespanOrder=_useState10[0],setTimespanOrder=_useState10[1];var _useState11=useState(3600*24*30),_useState12=_slicedToArray(_useState11,2),timespanTrade=_useState12[0],setTimespanTrade=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),busellFilter=_useState14[0],setBuysellFilter=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),hideOthersOpen=_useState16[0],setHideOthersOpen=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),hideOthersOrder=_useState18[0],setHideOthersOrder=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),hideOthersTrade=_useState20[0],setHideOthersTrade=_useState20[1];var _useState21=useState(0),_useState22=_slicedToArray(_useState21,2),longShort=_useState22[0],setLongShort=_useState22[1];var selectedTokenRef=useRef();var accountRef=useRef();var intervalRef=useRef();var prefix=window.location.protocol+\"//\"+window.location.hostname;var limitTx=function limitTx(tx){return tx?tx.substring(0,5)+\"...\"+tx.substring(tx.length-6,tx.length):\"\";};var updateOpenOrder=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var url,response,rt;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:url=prefix+\"/api/getorder?chainid=56&owner=\"+account+\"&openclose=open\";_context.next=3;return fetch(url);case 3:response=_context.sent;_context.next=6;return response.json();case 6:rt=_context.sent;console.log(rt);setOpenOrders(rt);case 9:case\"end\":return _context.stop();}}},_callee);}));return function updateOpenOrder(){return _ref.apply(this,arguments);};}();var updateTradeHistories=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var url,response,rt;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:url=prefix+\"/api/getorder?chainid=56&owner=\"+account+\"&openclose=trade&timestamp=\"+(Date.now()-timespanTrade*1000);_context2.next=3;return fetch(url);case 3:response=_context2.sent;_context2.next=6;return response.json();case 6:rt=_context2.sent;setTradeHistories(rt);console.log(rt);case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function updateTradeHistories(){return _ref2.apply(this,arguments);};}();var getInAmount=function getInAmount(symbol){var am=0;openOrders.map(function(order){if(order.inAsset==symbol)am=am+order.inAmount;});return am;};var updateBalances=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var bl,subBnb,ethBalance,inAmount,total;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:bl=[];subBnb=0;if(!(!active||chainId!=56)){_context4.next=4;break;}return _context4.abrupt(\"return\");case 4:_context4.t0=Number;_context4.next=7;return library.getBalance(account);case 7:_context4.t1=_context4.sent;ethBalance=(0,_context4.t0)(_context4.t1);ethBalance=Number(ethBalance/Math.pow(10,WETH.decimals));inAmount=getInAmount('BNB');total=inAmount+ethBalance;subBnb=subBnb+total;bl.push({asset:'BNB',amount:ethBalance,inamount:inAmount,total:total,bnbvalue:total});_context4.next=16;return Promise.all(tokensList.map(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(token){var contract,tokenBalance,bnbvalue;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:contract=getContract(token.address,ERC20_ABI,library,account);_context3.t0=Number;_context3.next=4;return contract.balanceOf(account);case 4:_context3.t1=_context3.sent;tokenBalance=(0,_context3.t0)(_context3.t1);tokenBalance=tokenBalance/Math.pow(10,selectedToken.info.decimals);inAmount=getInAmount(token.symbol);total=tokenBalance+inAmount;bnbvalue=token.info.quote==\"BNB\"?Number(token.priceBNB)*total:total/Number(token.priceBNB);bl.push({asset:token.symbol,amount:tokenBalance,inamount:inAmount,total:total,bnbvalue:bnbvalue});subBnb=subBnb+bnbvalue;case 12:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x){return _ref4.apply(this,arguments);};}()));case 16:setTotalBnbBalance(subBnb);setBalances(JSON.parse(JSON.stringify(bl)));case 18:case\"end\":return _context4.stop();}}},_callee4);}));return function updateBalances(){return _ref3.apply(this,arguments);};}();var updateAll=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(account){updateOpenOrder();updateTradeHistories();updateBalances();}case 1:case\"end\":return _context5.stop();}}},_callee5);}));return function updateAll(){return _ref5.apply(this,arguments);};}();var orderCancel=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(orderId){var limitContract;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:limitContract=getContract(limitOrder,LIMIT_ABI,library,account);_context6.next=3;return limitContract.cancelOrder(orderId);case 3:case\"end\":return _context6.stop();}}},_callee6);}));return function orderCancel(_x2){return _ref6.apply(this,arguments);};}();useEffect(function(){if(selectedToken&&account){selectedTokenRef.current=selectedToken;accountRef.current=account;if(intervalRef.current){clearInterval(intervalRef.current);}updateAll();intervalRef.current=setInterval(function(){return updateAll();},10000);}return function(){if(intervalRef.current){clearInterval(intervalRef.current);}};},[selectedToken,account,active,longShort]);return/*#__PURE__*/_jsxs(\"div\",{className:\"d-none d-lg-block col-12 col-lg-8 orders-widget\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"ul\",{className:\"nav nav-pills mb-1\",id:\"pills-tab\",role:\"tablist\",children:[/*#__PURE__*/_jsx(\"li\",{className:\"nav-item\",role:\"presentation\",children:/*#__PURE__*/_jsx(\"button\",{className:\"nav-link bg-transparent active\",id:\"pills-home-tab\",\"data-bs-toggle\":\"pill\",\"data-bs-target\":\"#pills-home\",type:\"button\",role:\"tab\",\"aria-controls\":\"pills-home\",\"aria-selected\":\"true\",children:\"Open Orders\"})}),/*#__PURE__*/_jsx(\"li\",{className:\"nav-item\",role:\"presentation\",children:/*#__PURE__*/_jsx(\"button\",{className:\"nav-link bg-transparent\",id:\"pills-contact-tab\",\"data-bs-toggle\":\"pill\",\"data-bs-target\":\"#pills-contact\",type:\"button\",role:\"tab\",\"aria-controls\":\"pills-contact\",\"aria-selected\":\"false\",children:\"Trade History\"})}),/*#__PURE__*/_jsx(\"li\",{className:\"nav-item\",role:\"presentation\",children:/*#__PURE__*/_jsx(\"button\",{className:\"nav-link bg-transparent\",id:\"pills-balances-tab\",\"data-bs-toggle\":\"pill\",\"data-bs-target\":\"#pills-balances\",type:\"button\",role:\"tab\",\"aria-controls\":\"pills-balances\",\"aria-selected\":\"false\",children:\"Balances\"})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"tab-content\",id:\"pills-tabContent\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tab-pane fade show active\",id:\"pills-home\",role:\"tabpanel\",\"aria-labelledby\":\"pills-home-tab\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"orders-widget__subtoolbar p-1 d-flex justify-content-between align-items-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"form-check\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-check-input custom-checkbox\",type:\"checkbox\",defaultValue:true,id:\"flexCheckDefault\",checked:hideOthersOpen,onClick:function onClick(){return setHideOthersOpen(!hideOthersOpen);}}),/*#__PURE__*/_jsx(\"label\",{className:\"form-check-label\",htmlFor:\"flexCheckDefault\",children:\"Hide Other Pairs\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"table text-white table-sm table-borderless\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"TxHash\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Pair\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Side\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Price\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Action\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:openOrders.map(function(order,idx){if(!hideOthersOpen||order.pairs.indexOf(selectedToken===null||selectedToken===void 0?void 0:selectedToken.symbol)>=0){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:limitTx(order.transactionid)}),/*#__PURE__*/_jsx(\"td\",{children:adjustDate(order.timestamp)}),/*#__PURE__*/_jsx(\"td\",{children:order.pairs}),/*#__PURE__*/_jsx(\"td\",{children:order.side}),/*#__PURE__*/_jsx(\"td\",{children:order.price}),/*#__PURE__*/_jsx(\"td\",{children:order.amount}),/*#__PURE__*/_jsx(\"td\",{role:\"button\",className:\"text-danger\",onClick:function onClick(){return orderCancel(order.orderid);},children:\"Cancel\"})]},idx);}})})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"tab-pane fade\",id:\"pills-contact\",role:\"tabpanel\",\"aria-labelledby\":\"pills-contact-tab\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"orders-widget__subtoolbar p-1 row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"form-check\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-check-input custom-checkbox\",type:\"checkbox\",defaultValue:true,id:\"flexCheckDefault\",checked:hideOthersTrade,onClick:function onClick(){return setHideOthersTrade(!hideOthersTrade);}}),/*#__PURE__*/_jsx(\"label\",{className:\"form-check-label\",htmlFor:\"flexCheckDefault\",children:\"Hide Other Pairs\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-10 d-flex align-items-center justify-content-end\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"me-1\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"me-2\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Type: \"}),/*#__PURE__*/_jsxs(\"div\",{className:\"btn-group\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"btn btn-secondary btn-sm dropdown-toggle\",type:\"button\",id:\"dropdownMenuButton1\",\"data-bs-toggle\":\"dropdown\",\"aria-expanded\":\"false\",children:[(longShort==0||longShort==1)&&/*#__PURE__*/_jsx(\"span\",{className:\"text-success\",children:\"Buy \"}),(longShort==0||longShort==2)&&/*#__PURE__*/_jsx(\"span\",{className:\"text-danger\",children:\"Sell\"})]}),/*#__PURE__*/_jsxs(\"ul\",{className:\"dropdown-menu dropdown-menu-dark\",\"aria-labelledby\":\"dropdownMenuButton1\",children:[/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"a\",{className:\"dropdown-item\",role:\"button\",onClick:function onClick(){return setLongShort(0);},children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-success\",children:\"Buy \"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-danger\",children:\"Sell\"})]})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"a\",{className:\"dropdown-item\",role:\"button\",onClick:function onClick(){return setLongShort(1);},children:/*#__PURE__*/_jsx(\"span\",{className:\"text-success\",children:\"Buy \"})})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"a\",{className:\"dropdown-item\",role:\"button\",onClick:function onClick(){return setLongShort(2);},children:/*#__PURE__*/_jsx(\"span\",{className:\"text-danger\",children:\"Sell\"})})})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"btn-group btn-group-sm\",role:\"group\",\"aria-label\":\"Basic example\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary me-1\",onClick:function onClick(){return timespanTrade(24*3600);},children:\"1 Day\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary me-1\",onClick:function onClick(){return timespanTrade(24*3600*7);},children:\"1 Week\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary me-1\",onClick:function onClick(){return timespanTrade(24*3600*30);},children:\"1 Month\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary me-1\",onClick:function onClick(){return timespanTrade(24*3600*93);},children:\"3 Months\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"table text-white table-sm table-borderless\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Tx\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Pair\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Side\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Price\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Filled\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Total\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:tradeHistories.map(function(order,idx){if(!hideOthersTrade||order.pairs.indexOf(selectedToken===null||selectedToken===void 0?void 0:selectedToken.symbol)>=0){if(longShort==0||longShort==1&&order.side=='buy'||longShort==2&&order.side=='sell'){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:limitTx(order.transactionid)}),/*#__PURE__*/_jsx(\"td\",{children:adjustDate(order.timestamp)}),/*#__PURE__*/_jsx(\"td\",{children:order.pairs}),/*#__PURE__*/_jsx(\"td\",{children:order.side}),/*#__PURE__*/_jsx(\"td\",{children:order.price}),/*#__PURE__*/_jsx(\"td\",{children:order.amount}),/*#__PURE__*/_jsx(\"td\",{children:fixedLength(order.price*order.amount)})]},idx);}}})})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"tab-pane fade\",id:\"pills-balances\",role:\"tabpanel\",\"aria-labelledby\":\"pills-balances-tab\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"orders-widget__subtoolbar p-1 d-flex justify-content-end align-items-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-1\",children:[\"Estimated Value: \",fixedLength(totalBnbBalance),\"BNB / $\",fixedLength(totalBnbBalance*bnbPrice)]})}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"table text-white table-sm table-borderless\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Asset\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Total Balance\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Available Balance\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"In Order\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"BNB Value\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:balances.map(function(balance,idx){if(Number(balance.bnbvalue)>0){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:balance.asset}),/*#__PURE__*/_jsx(\"td\",{children:balance.total}),/*#__PURE__*/_jsx(\"td\",{children:balance.amount}),/*#__PURE__*/_jsx(\"td\",{children:balance.inamount}),/*#__PURE__*/_jsx(\"td\",{children:balance.bnbvalue})]},idx);}})})]})})]})]})]});}export default Orderhistory;","map":{"version":3,"sources":["/root/dex/frontend/src/component/Orderhistory.js"],"names":["useSharedState","React","useState","useEffect","useCallback","useMemo","useRef","useWeb3React","fixedLength","adjustDate","ERC20_ABI","WETH","limitOrder","getContract","LIMIT_ABI","Orderhistory","selectedToken","setSelectedToken","bnbPrice","tokensList","chainId","account","activate","active","library","openOrders","setOpenOrders","tradeHistories","setTradeHistories","balances","setBalances","totalBnbBalance","setTotalBnbBalance","timespanOrder","setTimespanOrder","timespanTrade","setTimespanTrade","busellFilter","setBuysellFilter","hideOthersOpen","setHideOthersOpen","hideOthersOrder","setHideOthersOrder","hideOthersTrade","setHideOthersTrade","longShort","setLongShort","selectedTokenRef","accountRef","intervalRef","prefix","window","location","protocol","hostname","limitTx","tx","substring","length","updateOpenOrder","url","fetch","response","json","rt","console","log","updateTradeHistories","Date","now","getInAmount","symbol","am","map","order","inAsset","inAmount","updateBalances","bl","subBnb","Number","getBalance","ethBalance","Math","pow","decimals","total","push","asset","amount","inamount","bnbvalue","Promise","all","token","contract","address","balanceOf","tokenBalance","info","quote","priceBNB","JSON","parse","stringify","updateAll","orderCancel","orderId","limitContract","cancelOrder","current","clearInterval","setInterval","idx","pairs","indexOf","transactionid","timestamp","side","price","orderid","balance"],"mappings":"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","sourcesContent":["import useSharedState from '../hook/useSharedState'\r\nimport React ,{useState,useEffect,useCallback,useMemo,useRef} from \"react\";\r\nimport { useWeb3React } from '@web3-react/core'\r\nimport {fixedLength,adjustDate} from \"./common\"\r\nimport {ERC20_ABI} from \"../abi/ERC20\";\r\nimport { WETH,limitOrder} from \"./const\";\r\nimport {getContract} from \"./contract\";\r\nimport {LIMIT_ABI} from \"../abi/LIMIT\";\r\n\r\nfunction Orderhistory() {\r\n\r\n  const {selectedToken,setSelectedToken,bnbPrice,tokensList}=useSharedState();//useState(undefined);\r\n  const { chainId, account, activate, active,library } = useWeb3React();\r\n  const [openOrders,setOpenOrders] = useState([]);\r\n  const [tradeHistories,setTradeHistories] = useState([]);\r\n  const [balances,setBalances] = useState([]);\r\n  const [totalBnbBalance,setTotalBnbBalance] =useState(0);\r\n  const [timespanOrder,setTimespanOrder]=useState(3600*24*30);\r\n  const [timespanTrade,setTimespanTrade]=useState(3600*24*30);\r\n  const [busellFilter,setBuysellFilter]=useState(0);\r\n  const [hideOthersOpen,setHideOthersOpen]=useState(false);\r\n  const [hideOthersOrder,setHideOthersOrder]=useState(false);\r\n  const [hideOthersTrade,setHideOthersTrade]=useState(false);\r\n  \r\n  const [longShort,setLongShort] = useState(0);  \r\n  const selectedTokenRef = useRef();\r\n  const accountRef = useRef();\r\n  const intervalRef = useRef();\r\n\r\n  const prefix = window.location.protocol+\"//\"+window.location.hostname;\r\n  const limitTx = (tx)=>{\r\n    return tx?(tx.substring(0,5)+\"...\"+tx.substring(tx.length-6,tx.length)):\"\";\r\n  }\r\n  const updateOpenOrder = async()=>{\r\n    const url = prefix+\"/api/getorder?chainid=56&owner=\"+account+\"&openclose=open\";\r\n    const response = await fetch(url);\r\n    const rt = await response.json();\r\n    console.log(rt);\r\n    setOpenOrders(rt)\r\n  }\r\n  const updateTradeHistories = async()=>{\r\n    const url = prefix+\"/api/getorder?chainid=56&owner=\"+account+\"&openclose=trade&timestamp=\"+(Date.now()-timespanTrade*1000);\r\n    const response = await fetch(url);\r\n    const rt = await response.json();\r\n    setTradeHistories(rt)\r\n    console.log(rt);\r\n  }\r\n  const getInAmount = (symbol)=>{\r\n    let am = 0;\r\n    openOrders.map((order)=>{\r\n      if(order.inAsset==symbol) am=am+order.inAmount;\r\n    })\r\n    return am;\r\n  }\r\n  const updateBalances = async()=>{\r\n    let bl = [];\r\n    let subBnb = 0;\r\n    if(!active || chainId!=56) return;\r\n//    console.log({account,active})\r\n    let ethBalance = Number(await library.getBalance(account));\r\n    ethBalance = Number(ethBalance / Math.pow(10,WETH.decimals));\r\n    let inAmount = getInAmount('BNB');\r\n    let total = inAmount+ethBalance;\r\n    subBnb = subBnb+total;\r\n    bl.push({asset:'BNB',amount:ethBalance,inamount:inAmount,total:total,bnbvalue:total});\r\n    await Promise.all(tokensList.map(async(token)=>{\r\n      const contract = getContract(token.address, ERC20_ABI,library,account);\r\n      let tokenBalance = Number(await contract.balanceOf(account));\r\n      tokenBalance=tokenBalance / Math.pow(10,selectedToken.info.decimals);\r\n      inAmount = getInAmount(token.symbol);\r\n      total = tokenBalance+inAmount;\r\n      const bnbvalue = token.info.quote==\"BNB\"? (Number(token.priceBNB)*total):(total/Number(token.priceBNB));\r\n      bl.push({asset:token.symbol,amount:tokenBalance,inamount:inAmount,total:total,bnbvalue:bnbvalue});\r\n      subBnb = subBnb+bnbvalue;\r\n\r\n    }))\r\n    setTotalBnbBalance(subBnb);\r\n    setBalances(JSON.parse(JSON.stringify(bl)));\r\n  }\r\n  const updateAll = async()=>{\r\n    if(account){\r\n      updateOpenOrder();\r\n      updateTradeHistories();\r\n      updateBalances();    \r\n    }\r\n  }\r\n  const orderCancel = async(orderId)=>{\r\n    const limitContract = getContract(limitOrder, LIMIT_ABI,library,account);\r\n    await limitContract.cancelOrder(orderId);\r\n  }\r\n  useEffect(() => {\r\n    if(selectedToken && account){\r\n        selectedTokenRef.current = selectedToken;\r\n        accountRef.current = account;\r\n        if(intervalRef.current){\r\n            clearInterval(intervalRef.current);\r\n        }\r\n        updateAll();\r\n        intervalRef.current = setInterval(() => updateAll(), 10000);\r\n    }\r\n    return () => {\r\n        if(intervalRef.current){\r\n            clearInterval(intervalRef.current);\r\n        }\r\n    }\r\n  }, [selectedToken,account,active,longShort])\r\n\r\n  return (\r\n  <div className=\"d-none d-lg-block col-12 col-lg-8 orders-widget\">\r\n    <div>\r\n      <ul className=\"nav nav-pills mb-1\" id=\"pills-tab\" role=\"tablist\">\r\n        <li className=\"nav-item\" role=\"presentation\">\r\n          <button className=\"nav-link bg-transparent active\" id=\"pills-home-tab\" data-bs-toggle=\"pill\" data-bs-target=\"#pills-home\" type=\"button\" role=\"tab\" aria-controls=\"pills-home\" aria-selected=\"true\">Open Orders</button>\r\n        </li>\r\n        <li className=\"nav-item\" role=\"presentation\">\r\n          <button className=\"nav-link bg-transparent\" id=\"pills-contact-tab\" data-bs-toggle=\"pill\" data-bs-target=\"#pills-contact\" type=\"button\" role=\"tab\" aria-controls=\"pills-contact\" aria-selected=\"false\">Trade History</button>\r\n        </li>\r\n        <li className=\"nav-item\" role=\"presentation\">\r\n          <button className=\"nav-link bg-transparent\" id=\"pills-balances-tab\" data-bs-toggle=\"pill\" data-bs-target=\"#pills-balances\" type=\"button\" role=\"tab\" aria-controls=\"pills-balances\" aria-selected=\"false\">Balances</button>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n    <div className=\"tab-content\" id=\"pills-tabContent\">\r\n      <div className=\"tab-pane fade show active\" id=\"pills-home\" role=\"tabpanel\" aria-labelledby=\"pills-home-tab\">\r\n        <div className=\"orders-widget__subtoolbar p-1 d-flex justify-content-between align-items-center\">\r\n          <div className=\"form-check\">\r\n            <input className=\"form-check-input custom-checkbox\" type=\"checkbox\" defaultValue id=\"flexCheckDefault\"\r\n            checked={hideOthersOpen} onClick={()=>setHideOthersOpen(!hideOthersOpen)}/>\r\n            <label className=\"form-check-label\" htmlFor={\"flexCheckDefault\"}>\r\n              Hide Other Pairs\r\n            </label>\r\n          </div>\r\n        </div>\r\n        <div className=\"table-responsive\">\r\n          <table className=\"table text-white table-sm table-borderless\">\r\n            <thead>\r\n              <tr>\r\n                <th scope=\"col\">TxHash</th>\r\n                <th scope=\"col\">Date</th>\r\n                <th scope=\"col\">Pair</th>\r\n                <th scope=\"col\">Side</th>\r\n                <th scope=\"col\">Price</th>\r\n                <th scope=\"col\">Amount</th>\r\n                <th scope=\"col\">Action</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n            {openOrders.map((order,idx)=>{\r\n              if (!hideOthersOpen || order.pairs.indexOf(selectedToken?.symbol)>=0){\r\n                return( \r\n                  <tr key={idx}>\r\n                    <td>{limitTx(order.transactionid)}</td>\r\n                    <td>{adjustDate(order.timestamp)}</td>\r\n                    <td>{order.pairs}</td>\r\n                    <td>{order.side}</td>\r\n                    <td>{order.price}</td>\r\n                    <td>{order.amount}</td>\r\n                    <td role=\"button\" className=\"text-danger\" onClick={()=>orderCancel(order.orderid)}>Cancel</td>\r\n                  </tr>\r\n                 )\r\n              }\r\n            })}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n      <div className=\"tab-pane fade\" id=\"pills-contact\" role=\"tabpanel\" aria-labelledby=\"pills-contact-tab\">\r\n        <div className=\"orders-widget__subtoolbar p-1 row\">\r\n          <div className=\"col-2\">\r\n            <div className=\"form-check\">\r\n              <input className=\"form-check-input custom-checkbox\" type=\"checkbox\" defaultValue id=\"flexCheckDefault\" \r\n              checked={hideOthersTrade} onClick={()=>setHideOthersTrade(!hideOthersTrade)}/>\r\n              <label className=\"form-check-label\" htmlFor={\"flexCheckDefault\"}>\r\n                Hide Other Pairs\r\n              </label>\r\n            </div>\r\n          </div>\r\n          <div className=\"col-10 d-flex align-items-center justify-content-end\">\r\n            <div className=\"me-1\">\r\n            {/*\r\n              <label >Pair: </label>\r\n              <input type=\"text\" className=\"bg-secondary text-white border-0\" style={{width: '50px'}} placeholder=\"Coin\" />\r\n              <label >/</label>\r\n              <div className=\"btn-group me-2\">\r\n                <button className=\"btn btn-secondary btn-sm dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton1\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n                  BNB\r\n                </button>\r\n                <ul className=\"dropdown-menu dropdown-menu-dark dropdown-menu-end\" aria-labelledby=\"dropdownMenuButton1\">\r\n                  <li><a className=\"dropdown-item\" href=\"#\">BNB</a></li>\r\n                  <li><a className=\"dropdown-item\" href=\"#\">BUSD</a></li>\r\n                  <li><a className=\"dropdown-item\" href=\"#\">BTCB</a></li>\r\n                  <li><a className=\"dropdown-item\" href=\"#\">ETH</a></li>\r\n                  <li><a className=\"dropdown-item\" href=\"#\">IDRTB</a></li>\r\n                  <li><a className=\"dropdown-item\" href=\"#\">TAUDB</a></li>\r\n                  <li><a className=\"dropdown-item\" href=\"#\">THKDB</a></li>\r\n                  <li><a className=\"dropdown-item\" href=\"#\">TUSDB</a></li>\r\n                  <li><a className=\"dropdown-item\" href=\"#\">USDSB</a></li>\r\n                  <li><a className=\"dropdown-item\" href=\"#\">USDT</a></li>\r\n                  <li><a className=\"dropdown-item\" href=\"#\">DAI</a></li>\r\n                </ul>\r\n              </div>*/\r\n            }\r\n            </div>\r\n            <div className=\"me-2\">\r\n              <label >Type: </label>\r\n              <div className=\"btn-group\">\r\n                <button className=\"btn btn-secondary btn-sm dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton1\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n                  {(longShort==0 || longShort==1 )&& \r\n                    <span className=\"text-success\">Buy </span> \r\n                  }\r\n                  {(longShort==0 || longShort==2 )&& \r\n                    <span className=\"text-danger\">Sell</span>\r\n                  }\r\n\r\n                </button>\r\n                <ul className=\"dropdown-menu dropdown-menu-dark\" aria-labelledby=\"dropdownMenuButton1\">\r\n                  <li>\r\n                    <a className=\"dropdown-item\" role=\"button\" onClick={()=>setLongShort(0)}>\r\n                      <span className=\"text-success\">Buy </span>\r\n                      <span className=\"text-danger\">Sell</span>\r\n                    </a>\r\n                  </li>\r\n                  <li>\r\n                    <a className=\"dropdown-item\" role=\"button\" onClick={()=>setLongShort(1)}>\r\n                      <span className=\"text-success\">Buy </span>\r\n                    </a>\r\n                  </li>\r\n                  <li>\r\n                    <a className=\"dropdown-item\" role=\"button\" onClick={()=>setLongShort(2)}>\r\n                      <span className=\"text-danger\">Sell</span>\r\n                    </a>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            </div>\r\n            <div className=\"btn-group btn-group-sm\" role=\"group\" aria-label=\"Basic example\">\r\n              <button type=\"button\" className=\"btn btn-secondary me-1\" onClick={()=>timespanTrade(24*3600)}>1 Day</button>\r\n              <button type=\"button\" className=\"btn btn-secondary me-1\" onClick={()=>timespanTrade(24*3600*7)}>1 Week</button>\r\n              <button type=\"button\" className=\"btn btn-secondary me-1\"  onClick={()=>timespanTrade(24*3600*30)}>1 Month</button>\r\n              <button type=\"button\" className=\"btn btn-secondary me-1\"  onClick={()=>timespanTrade(24*3600*93)}>3 Months</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"table-responsive\">\r\n          <table className=\"table text-white table-sm table-borderless\">\r\n            <thead>\r\n              <tr>\r\n                <th scope=\"col\">Tx</th>\r\n                <th scope=\"col\">Date</th>\r\n                <th scope=\"col\">Pair</th>\r\n                <th scope=\"col\">Side</th>\r\n                <th scope=\"col\">Price</th>\r\n                <th scope=\"col\">Filled</th>\r\n                <th scope=\"col\">Total</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {tradeHistories.map((order,idx)=>{\r\n                  if (!hideOthersTrade || order.pairs.indexOf(selectedToken?.symbol)>=0){\r\n                    if(longShort==0 ||\r\n                      (longShort==1 && order.side=='buy') ||\r\n                      (longShort==2 && order.side=='sell')\r\n                      ){\r\n                    return (\r\n                      <tr key={idx}>\r\n                        <td>{limitTx(order.transactionid)}</td>\r\n                        <td>{adjustDate(order.timestamp)}</td>\r\n                        <td>{order.pairs}</td>\r\n                        <td>{order.side}</td>\r\n                        <td>{order.price}</td>\r\n                        <td>{order.amount}</td>\r\n                        <td >{fixedLength(order.price*order.amount)}</td>\r\n                      </tr>\r\n                     )\r\n                    }\r\n                  }\r\n              })}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n      <div className=\"tab-pane fade\" id=\"pills-balances\" role=\"tabpanel\" aria-labelledby=\"pills-balances-tab\">\r\n        <div className=\"orders-widget__subtoolbar p-1 d-flex justify-content-end align-items-center\">\r\n          <div className=\"text-1\">\r\n        Estimated Value: {fixedLength(totalBnbBalance)}BNB / ${fixedLength(totalBnbBalance*bnbPrice)}</div>\r\n        </div>\r\n        <div className=\"table-responsive\">\r\n          <table className=\"table text-white table-sm table-borderless\">\r\n            <thead>\r\n              <tr>\r\n                <th scope=\"col\">Asset</th>\r\n                <th scope=\"col\">Total Balance</th>\r\n                <th scope=\"col\">Available Balance</th>\r\n                <th scope=\"col\">In Order</th>\r\n                <th scope=\"col\">BNB Value</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {balances.map((balance,idx)=>\r\n                {\r\n                  if(Number(balance.bnbvalue)>0){\r\n                    return(\r\n                      <tr key={idx}>\r\n                        <td>{balance.asset}</td>\r\n                        <td>{balance.total}</td>\r\n                        <td>{balance.amount}</td>\r\n                        <td>{balance.inamount}</td>\r\n                        <td>{balance.bnbvalue}</td>\r\n                      </tr>\r\n                    )\r\n                  }\r\n                }\r\n              )}\r\n\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  );\r\n}\r\n\r\nexport default Orderhistory;\r\n"]},"metadata":{},"sourceType":"module"}