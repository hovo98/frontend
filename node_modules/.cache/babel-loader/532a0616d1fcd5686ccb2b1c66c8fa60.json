{"ast":null,"code":"var _jsxFileName = \"/root/dex/frontend/src/component/Tokens.js\",\n    _s = $RefreshSig$();\n\nimport useSharedState from '../hook/useSharedState';\nimport React, { useState, useEffect, useCallback, useMemo } from \"react\";\nimport io from 'socket.io-client';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction Tokens() {\n  _s();\n\n  const {\n    selectedToken,\n    setSelectedToken,\n    bnbPrice,\n    setBnbPrice,\n    ask,\n    setAsk,\n    long,\n    setLong,\n    setBid,\n    tokensList,\n    setTokensList\n  } = useSharedState(); //useState(undefined);\n\n  const favpos = \"favbsc\";\n  const [fav, setFav] = useState(localStorage.getItem(favpos) ? JSON.parse(localStorage.getItem(favpos)) : {});\n  const [sortMode, setSortMode] = useState('CHANGE');\n  const options = ['CHANGE', 'VOLUME'];\n  const [order, setOrder] = useState(0);\n  const [sortedData, setSortedData] = useState([]);\n  useEffect(() => {\n    const init = async () => {\n      const prefix = window.location.protocol + \"//\" + window.location.hostname;\n      const url = prefix + \"/api/getdata?op=pairs24h\";\n      const response = await fetch(url);\n      const pairs = await response.json();\n      setTokensList(pairs);\n\n      for (let i = 0; i < pairs.length; i++) {\n        if (pairs[i].symbol == \"USDT\") {\n          setBnbPrice(Number(pairs[i].priceUSD));\n\n          if (!selectedToken) {\n            setSelectedToken(pairs[i]);\n          }\n        }\n      }\n\n      const socket = io(prefix);\n      socket.emit(\"join\", \"pairs24h\"); // listen for new messages\n\n      socket.on(\"data\", function (data) {\n        setTokensList(data);\n\n        if (selectedToken) {\n          for (let i = 0; i < data.length; i++) {\n            if (data[i].symbol == selectedToken.symbol) {\n              setAsk(ask => {\n                setLong(ask <= Number(data[i].priceBNB));\n                return Number(data[i].priceBNB);\n              });\n              setBid(Number(data[i].priceBNB));\n            }\n          }\n        }\n      });\n      const socketbnb = io(prefix);\n      socketbnb.emit(\"join\", \"BNBUSDT\"); // listen for new messages\n\n      socketbnb.on(\"orderbook\", function (data) {\n        console.log(data);\n        setBnbPrice(Number(data.asks[0][0]));\n      });\n    };\n\n    init();\n  }, []);\n  useEffect(() => {\n    const setSortData = () => {\n      if ((tokensList === null || tokensList === void 0 ? void 0 : tokensList.length) > 0) {\n        let newData = tokensList;\n        newData.sort((a, b) => {\n          if (fav[a.address]) return -1;\n          if (fav[b.address]) return 1;\n          if (fav[a.address] && fav[b.address]) return 0;\n          if (sortMode == 'CHANGE') return Math.sign((b.priceBNBChange - a.priceBNBChange) * (1 - 2 * order));\n          return Math.sign((b.volumeUSDChange - a.volumeUSDChange) * (1 - 2 * order));\n        });\n        setSortedData([...newData]);\n      }\n    };\n\n    setSortData();\n  }, [tokensList, sortMode, fav]);\n\n  const setToken = token => {\n    setSelectedToken(token);\n    setLong(true);\n    setAsk(Number(token.priceBNB));\n  };\n\n  const changeFav = token => {\n    if (fav[token.address]) {\n      removeFav(token);\n    } else {\n      addFav(token);\n    }\n  };\n\n  const addFav = token => {\n    let newFav = fav;\n    newFav[token.address] = true;\n    setFav({ ...newFav\n    });\n    localStorage.setItem(favpos, JSON.stringify(newFav));\n  };\n\n  const removeFav = token => {\n    let newFav = fav;\n    delete newFav[token.address];\n    setFav({ ...newFav\n    });\n    localStorage.setItem(favpos, JSON.stringify(newFav));\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row m-0\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-12 p-0 m-0\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-check form-check-inline m-0 pe-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"form-check-input\",\n            value: \"CHANGE\",\n            checked: sortMode === \"CHANGE\",\n            onChange: e => {\n              setSortMode(e.currentTarget.value);\n            },\n            type: \"radio\",\n            name: \"inlineRadioOptions\",\n            id: \"inlineRadio1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 112,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"form-check-label\",\n            htmlFor: \"inlineRadio1\",\n            children: \"Change\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 113,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 19\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-check form-check-inline m-0\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"form-check-input\",\n            value: \"VOLUME\",\n            checked: sortMode === \"VOLUME\",\n            onChange: e => {\n              setSortMode(e.currentTarget.value);\n            },\n            type: \"radio\",\n            name: \"inlineRadioOptions\",\n            id: \"inlineRadio2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 116,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"form-check-label\",\n            htmlFor: \"inlineRadio2\",\n            children: \"Volume\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 19\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 15\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"tab-pane fade show active\",\n      id: \"pills-bnb\",\n      role: \"tabpanel\",\n      \"aria-labelledby\": \"pills-bnb-tab\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"table-responsive\",\n        style: {\n          \"height\": \"200px\",\n          \"overflowY\": \"scroll\"\n        },\n        children: /*#__PURE__*/_jsxDEV(\"table\", {\n          className: \"table text-white table-sm table-borderless\",\n          children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n            className: \"text-muted\",\n            children: /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                scope: \"col\",\n                children: \"Pair\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 126,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                scope: \"col\",\n                children: \"Price\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 127,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                scope: \"col\",\n                children: \"Change\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 128,\n                columnNumber: 25\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 125,\n              columnNumber: 23\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 124,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n            children: [sortedData.length == 0 && /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: /*#__PURE__*/_jsxDEV(\"td\", {\n                colSpan: \"3\",\n                children: \"Loading...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 134,\n                columnNumber: 25\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 133,\n              columnNumber: 23\n            }, this), sortedData.map((token, idx) => /*#__PURE__*/_jsxDEV(\"tr\", {\n              role: \"button\",\n              onClick: e => {\n                setToken(token);\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                className: \"text-nowrap\",\n                children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                  className: \"bi  me-1 text-warning \" + (fav[token.address] ? \"bi-star-fill\" : \"bi-star\"),\n                  onClick: e => {\n                    e.stopPropagation();\n                    changeFav(token);\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 140,\n                  columnNumber: 29\n                }, this), token.info.base, \"/\", token.info.quote]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 139,\n                columnNumber: 27\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: token.priceBNB\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 143,\n                columnNumber: 27\n              }, this), sortMode == 'CHANGE' && /*#__PURE__*/_jsxDEV(\"td\", {\n                className: \"text-end pe-2 \" + (token.priceBNBChange > 0 ? \" text-success\" : \"text-danger\"),\n                children: [token.priceBNBChange > 0 ? \"+\" : \"\", token.priceBNBChange.toFixed(2), \"%\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 145,\n                columnNumber: 29\n              }, this), sortMode == 'VOLUME' && /*#__PURE__*/_jsxDEV(\"td\", {\n                className: \"text-end pe-2 \" + (token.volumeUSDChange > 0 ? \" text-success\" : \"text-danger\"),\n                children: [token.volumeUSDChange > 0 ? \"+\" : \"\", token.volumeUSDChange.toFixed(2), \"%\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 148,\n                columnNumber: 29\n              }, this)]\n            }, idx, true, {\n              fileName: _jsxFileName,\n              lineNumber: 138,\n              columnNumber: 25\n            }, this))]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 19\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 15\n    }, this)]\n  }, void 0, true);\n}\n\n_s(Tokens, \"O5BgsYFrc0cbQNyaLzPSHBxr0mY=\", false, function () {\n  return [useSharedState];\n});\n\n_c = Tokens;\nexport default Tokens;\n\nvar _c;\n\n$RefreshReg$(_c, \"Tokens\");","map":{"version":3,"sources":["/root/dex/frontend/src/component/Tokens.js"],"names":["useSharedState","React","useState","useEffect","useCallback","useMemo","io","Tokens","selectedToken","setSelectedToken","bnbPrice","setBnbPrice","ask","setAsk","long","setLong","setBid","tokensList","setTokensList","favpos","fav","setFav","localStorage","getItem","JSON","parse","sortMode","setSortMode","options","order","setOrder","sortedData","setSortedData","init","prefix","window","location","protocol","hostname","url","response","fetch","pairs","json","i","length","symbol","Number","priceUSD","socket","emit","on","data","priceBNB","socketbnb","console","log","asks","setSortData","newData","sort","a","b","address","Math","sign","priceBNBChange","volumeUSDChange","setToken","token","changeFav","removeFav","addFav","newFav","setItem","stringify","e","currentTarget","value","map","idx","stopPropagation","info","base","quote","toFixed"],"mappings":"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","sourcesContent":["import useSharedState from '../hook/useSharedState'\r\nimport React ,{useState,useEffect,useCallback,useMemo} from \"react\";\r\nimport io from 'socket.io-client';\r\n\r\nfunction Tokens() {\r\n\r\n  const {selectedToken,setSelectedToken,bnbPrice,setBnbPrice,ask,setAsk,long,setLong,setBid,tokensList,setTokensList}=useSharedState();//useState(undefined);\r\n  const favpos = \"favbsc\";\r\n  const [fav,setFav]=useState(localStorage.getItem(favpos)?JSON.parse(localStorage.getItem(favpos)):{})\r\n  const [sortMode, setSortMode] = useState('CHANGE');\r\n  const options = ['CHANGE', 'VOLUME'];\r\n  const [order,setOrder]=useState(0)\r\n\r\n  const [sortedData, setSortedData] = useState([]);\r\n\r\n  useEffect(() => {\r\n      const init=async()=>{\r\n        const prefix = window.location.protocol+\"//\"+window.location.hostname;\r\n        const url = prefix+\"/api/getdata?op=pairs24h\";\r\n        const response = await fetch(url);\r\n        const pairs = await response.json();\r\n        setTokensList(pairs);\r\n        for(let i=0;i<pairs.length;i++){\r\n          if(pairs[i].symbol==\"USDT\"){\r\n            setBnbPrice(Number(pairs[i].priceUSD));\r\n            if(!selectedToken){\r\n              setSelectedToken(pairs[i]);\r\n            }\r\n          }\r\n        }\r\n\r\n        const socket = io(prefix);\r\n        socket.emit(\"join\",\"pairs24h\");\r\n          // listen for new messages\r\n        socket.on(\"data\", function(data) {\r\n            setTokensList(data);\r\n            if(selectedToken){\r\n              for(let i=0;i<data.length;i++){\r\n                if(data[i].symbol==selectedToken.symbol){\r\n                  setAsk((ask)=>{\r\n                    setLong(ask<=Number(data[i].priceBNB));\r\n                    return Number(data[i].priceBNB)\r\n                  });\r\n                  setBid(Number(data[i].priceBNB));\r\n\r\n                }\r\n              }\r\n            }\r\n          });\r\n\r\n        const socketbnb = io(prefix);\r\n        socketbnb.emit(\"join\",\"BNBUSDT\");\r\n          // listen for new messages\r\n        socketbnb.on(\"orderbook\", function(data) {\r\n            console.log(data)\r\n            setBnbPrice(Number(data.asks[0][0]));\r\n          });\r\n      }\r\n      init();\r\n  }, []) \r\n\r\n  useEffect(() => {\r\n      const setSortData =()=>{\r\n          if(tokensList?.length>0){\r\n              let newData = tokensList;\r\n              newData.sort((a, b) => {\r\n                  if(fav[a.address]) return -1;\r\n                  if(fav[b.address]) return 1;\r\n                  if(fav[a.address] && fav[b.address]) return 0;\r\n                  \r\n                  if(sortMode =='CHANGE') return Math.sign((b.priceBNBChange-a.priceBNBChange)*(1-2*order))\r\n                  return Math.sign((b.volumeUSDChange-a.volumeUSDChange)*(1-2*order))\r\n              });\r\n              setSortedData([...newData]);\r\n          }\r\n      }\r\n      setSortData();\r\n    }, [tokensList,sortMode,fav])\r\n\r\n\r\n    const setToken = (token)=>{\r\n        setSelectedToken(token);\r\n        setLong(true);\r\n        setAsk(Number(token.priceBNB));\r\n    }\r\n\r\n    const changeFav = (token)=>{\r\n        if(fav[token.address]){\r\n            removeFav(token);\r\n        }else{\r\n            addFav(token);\r\n        }\r\n    }\r\n    \r\n    const addFav=(token)=>{\r\n        let newFav=fav; \r\n        newFav[token.address]=true;\r\n        setFav({...newFav})\r\n        localStorage.setItem(favpos,JSON.stringify(newFav));\r\n    }\r\n    const removeFav=(token)=>{\r\n        let newFav=fav;\r\n        delete newFav[token.address];\r\n        setFav({...newFav})\r\n        localStorage.setItem(favpos,JSON.stringify(newFav));\r\n    }\r\n  return (\r\n          <>\r\n              <div className=\"row m-0\">\r\n                <div className=\"col-12 p-0 m-0\">\r\n                  <div className=\"form-check form-check-inline m-0 pe-2\">\r\n                    <input className=\"form-check-input\" value=\"CHANGE\" checked={sortMode === \"CHANGE\"} onChange={(e)=>{setSortMode(e.currentTarget.value)}} type=\"radio\" name=\"inlineRadioOptions\" id=\"inlineRadio1\" />\r\n                    <label className=\"form-check-label\" htmlFor={\"inlineRadio1\"}>Change</label>\r\n                  </div>\r\n                  <div className=\"form-check form-check-inline m-0\">\r\n                    <input className=\"form-check-input\" value=\"VOLUME\" checked={sortMode === \"VOLUME\"} onChange={(e)=>{setSortMode(e.currentTarget.value)}} type=\"radio\" name=\"inlineRadioOptions\" id=\"inlineRadio2\" />\r\n                    <label className=\"form-check-label\" htmlFor={\"inlineRadio2\"}>Volume</label>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"tab-pane fade show active\" id=\"pills-bnb\" role=\"tabpanel\" aria-labelledby=\"pills-bnb-tab\">\r\n                <div className=\"table-responsive\" style={{\"height\":\"200px\",\"overflowY\":\"scroll\"}}>\r\n                  <table className=\"table text-white table-sm table-borderless\">\r\n                    <thead className=\"text-muted\" >\r\n                      <tr>\r\n                        <th scope=\"col\">Pair</th>\r\n                        <th scope=\"col\">Price</th>\r\n                        <th scope=\"col\">Change</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                    {sortedData.length==0 &&\r\n                      <tr>\r\n                        <td colSpan=\"3\">Loading...</td>\r\n                      </tr>\r\n                    }\r\n                    {sortedData.map((token,idx)=>(\r\n                        <tr role=\"button\" key={idx} onClick={(e)=>{setToken(token)}} >\r\n                          <td className=\"text-nowrap\">\r\n                            <i className={\"bi  me-1 text-warning \"+(fav[token.address]?\"bi-star-fill\":\"bi-star\")} onClick={(e)=>{e.stopPropagation();changeFav(token)}}/> \r\n                            {token.info.base}/{token.info.quote}\r\n                           </td>\r\n                          <td>{token.priceBNB}</td>\r\n                          {sortMode =='CHANGE' && \r\n                            <td className={\"text-end pe-2 \"+(token.priceBNBChange>0?\" text-success\":\"text-danger\")}>{token.priceBNBChange>0?\"+\":\"\"}{token.priceBNBChange.toFixed(2)}%</td>\r\n                          }\r\n                          {sortMode =='VOLUME' && \r\n                            <td className={\"text-end pe-2 \"+(token.volumeUSDChange>0?\" text-success\":\"text-danger\")}>{token.volumeUSDChange>0?\"+\":\"\"}{token.volumeUSDChange.toFixed(2)}%</td>\r\n                          }\r\n                        </tr>\r\n                    ))}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n          </>\r\n  );\r\n}\r\n\r\nexport default Tokens;\r\n"]},"metadata":{},"sourceType":"module"}